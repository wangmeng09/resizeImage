<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>

<input money-type="bitLength" type="number" name="price" ng-model="cartProduct.price"
maxlength='12' ng-pattern="/^([0-9]\d{0,7}(\.\d{0,5})?)$/">
<script>
	var typeArray = {
			0:{
	  bitLength:2,
	  roundOff:2,
	  unit:0
	 }
	 		,1:{
	  bitLength:2,
	  roundOff:2,
	  unit:0
	 }
	 		,2:{
	  bitLength:2,
	  roundOff:2,
	  unit:0
	 }
	 		,3:{
	  bitLength:2,
	  roundOff:2,
	  unit:0
	 }
	 	}
</script>
<script>
angular.module("myApp").directive("moneyType",function(){
	return {
		restrict:"A",
		scope:{
			pointlen:'=moneyType'
		},
		link:function(scope,element,attr){
			var cursor = 0;
			var max = 11,pointLen;
			scope.pointlen ? pointLen=scope.pointlen : pointLen = 2;
			function getCursor(elem){
				if(elem.selectionStart !== undefined){
					return elem.selectionStart;
				}else{
					var range = document.selection.createRange();
					var len = range.text.length;
					return len;
				}
			}
			angular.element(document).ready(function(){
				element.on("click",function(event){
					cursor = getCursor(event.target)
				})
				
				element.on("focus",function(event){
					cursor = event.target.value.length;
				})

				element.on("keydown",function(event){
					if(cursor >= max && event.keyCode != 8){
						cursor = max;
						return  false;
					}else{
						if((event.keyCode < 48 || event.keyCode >57) && event.keyCode != 190  && event.keyCode != 8){
							return false;
						}
						if((event.keyCode < 48 || event.keyCode >57) && pointLen == 0 && event.keyCode != 8){
							return false;
						}
						if(event.keyCode == 8 && cursor >0)
							cursor--;
						else{
							var elem = event.target;
							var text = elem.value;
							if(event.keyCode == 190){
								if(text.indexOf(".") == -1 && text.length-cursor<=pointLen){
									cursor++;
								}else{
									return false;
								}
							}else{
								var ary = text.split(".");
								var before = ary[0];
								var after = ary.length>1?ary[1]:"";
								if(cursor<=before.length && before.length >=max){
									return false;
								}
								else if(cursor > before.length && after.length >=pointLen)
									return false;
								else
									cursor++;
							}
						}
					}
				})
				
			})
		}
	}
})
</script>	
</body>
</html>
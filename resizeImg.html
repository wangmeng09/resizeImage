<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>压缩上传为base64</title>
    <link href="https://cdn.bootcss.com/photoswipe/4.1.2/photoswipe.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/photoswipe/4.1.2/default-skin/default-skin.min.css" rel="stylesheet">
    <style>
        .my-gallery {
            width: 100%;
            float: left;
        }
        .my-gallery img {
            width: 100%;
            height: auto;
        }
        .my-gallery figure {
            display: block;
            float: left;
            margin: 0 5px 5px 0;
            width: 100%;
        }
        .my-gallery figcaption {
            display: none;
        }
    </style>
</head>

<body >
<form action="">
    <input type="search" id="keyword">
</form>

<div class="my-gallery" itemscope>
    <div id="show">
    </div>
</div>
<div>
    <input type="file" id="fileUpload">
    <button type="button" id="doUpload">上传</button>
    <span id="info"></span>
</div>

<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <div class="pswp__bg"></div>

    <div class="pswp__scroll-wrap">

        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>
</div>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/axios/0.17.1/axios.min.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.2/photoswipe.min.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.2/photoswipe-ui-default.min.js"></script>
<script src="photo-swipe.js"></script>
<script src="s3.js"></script>
<script>
$(function () {
    $("#keyword").on('keypress',function(e) {
        var keycode = e.keyCode;
        var searchName = $(this).val();
        if(keycode=='13') {
            e.preventDefault();
            console.log(123)
            //请求搜索接口

        }
    });
    $('#fileUpload').on("change", function () {
        var fileUpload = $(this)[0].files[0];
        var reader = new FileReader();
        var result = s3.checkFile(fileUpload);
        s3.imageCompress(fileUpload,"",function (result) {
                $("#show").append(' <figure itemprop="associatedMedia" itemscope><a href="'+result+'" itemprop="contentUrl" data-size="1920x1080">' +
                    '<img src="'+result+'" itemprop="thumbnail" />' +
                    '</a></figure>')
        })

    })
    $("#doUpload").on("click",function(){
        var fileobj=$("#fileUpload");
        if(fileobj[0].files.length){
            var fileUpload=fileobj[0].files[0];
            var promise=s3.upload(fileUpload,{},)
            promise.then(function (result) {
                if(result['annexUrl']){
                    alert("上传成功，地址是："+result.annexUrl)
                }else{
                    alert(result.retMsg)
                }
            })
        }
    })

})
</script>
</body>
</html>